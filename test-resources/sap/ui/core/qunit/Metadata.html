<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Metadata - sap.ui.base</title>

		<script src="../shared-config.js"></script>
		<script id="sap-ui-bootstrap"
			src="../../../../../resources/sap-ui-core.js"
			data-sap-ui-noConflict="true" >
		</script>

		<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen">
		<script src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>

		<script>

			// define new type for testing
			var TestClass = sap.ui.base.Metadata.createClass("sap.ui.core.TestClass", {
				metadata : {
					// ---- control specific ----
					library : "sap.ui.core",
					publicMethods : ["a1", "a2", "a2"]	// duplicate present
				}
			});

			QUnit.module("Basic");

			QUnit.test("Lazy calculation of public method name uniqueness", function(assert) {
				var testObj = new TestClass();
				var metaData = testObj.getMetadata();

				// initial state checks
				assert.ok(!metaData._bInterfacesUnique, "dirty flag must be set");
				assert.deepEqual(metaData._aPublicMethods, ["a1", "a2", "a2"], "duplicates must be present before getting")

				// get public methods and assert correctness
				assert.deepEqual(metaData.getAllPublicMethods(), ["a1", "a2"], "obj must have 2 public methods");
				assert.ok(metaData._bInterfacesUnique, "dirty flag must be cleared");
			});

			QUnit.test("Lazy calculation of public method name uniqueness after addition", function(assert) {
				var testObj = new TestClass();
				var metaData = testObj.getMetadata();

				// initial state checks
				assert.deepEqual(metaData.getAllPublicMethods(), ["a1", "a2"], "obj must have 2 public methods");
				assert.ok(metaData._bInterfacesUnique, "dirty flag must be cleared");

				// add a duplicate and non-duplicate method name
				metaData.addPublicMethods(["a2", "a3"]);
				assert.deepEqual(metaData.getAllPublicMethods(), ["a1", "a2", "a3"], "obj must have 3 public methods");
				assert.ok(metaData._bInterfacesUnique, "dirty flag must be cleared");

				// add a duplicate and non-duplicate method name as arguments
				metaData.addPublicMethods("a3", "a4");
				assert.deepEqual(metaData.getAllPublicMethods(), ["a1", "a2", "a3", "a4"], "obj must have 4 public methods");
				assert.ok(metaData._bInterfacesUnique, "dirty flag must be cleared");
			});

		</script>
	</head>
	<body>
		<h1 id="qunit-header">QUnit Page for sap.ui.base.Metadata</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		<div id="qunit-fixture">test markup, will be hidden</div>
	</body>
</html>
