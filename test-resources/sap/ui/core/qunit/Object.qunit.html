<!DOCTYPE HTML>
<html>
	<head>

<!--
  JSUNIT:
    Tested control/class: sap.ui.base.Objects.js
    Author: Martin Schaus
 -->

		<title>Test Page for Object Class</title>
		<script src="../shared-config.js"></script>
		<script id="sap-ui-bootstrap"
				src="../../../../../resources/sap-ui-core.js"
				data-sap-ui-noConflict="true">
		</script>
		<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen">
		<script src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script>

		/*
		 * JSUNIT:
	     *     create your test fixture here, e.g. create SAPUI5 control tree and add it to
	     *     "uiArea1".
		 */

		if ( typeof Array.indexOf === "undefined" ) {
			Array.prototype.indexOf = function(m) {
	 			for(var i=0; i<this.length; i++) {
	 	 			if ( this[i] === m )
	 	 	 			return i;
	 			}
		 	 	return -1;
			};
		};

		function assertArrayEquals(sMessage, a1, a2) {
			if ( !a1 || !a2 ) {
				assert.strictEqual(a2, a1, sMessage);
				return;
			}

			var l1=a1.length,l2=a2.length;
			assert.strictEqual(l2, l1, sMessage);
			for(var i=0; i<l1; i++) {
				assert.strictEqual(a2[i], a1[i], sMessage);
			};
		};


		jQuery.sap.require("sap.ui.base.Object");
		jQuery.sap.declare("sap.test.NewClass");

		sap.test.NewClass = function(v1){ this.value1 = v1; };
		sap.test.NewClass.prototype = jQuery.sap.newObject(sap.ui.base.Object.prototype);
		sap.ui.base.Object.defineClass("sap.test.NewClass", {
				baseType : "sap.ui.base.Object",
				interfaces : ["sap.ui.base.Poolable"],
				publicMethods: ["method1"]
			});
		sap.test.NewClass.prototype.method1 = function() {
			return this.value1;
		};

		sap.test.NewSubClass = function(v1,v2){ sap.test.NewClass.call(this, v1); this.value2 = v2; };
		sap.test.NewSubClass.prototype = jQuery.sap.newObject(sap.test.NewClass.prototype);
		sap.ui.base.Object.defineClass("sap.test.NewSubClass", {
				baseType : "sap.test.NewClass",
				interfaces : ["sap.ui.base.Cacheable"],
				publicMethods: ["method2"]
			});
		sap.test.NewSubClass.prototype.method2 = function() {
			return this.value2;
		};

		QUnit.module("Base", {
			beforeEach : function() {
				oObject = new sap.ui.base.Object();
				oNewClassInstance = new sap.test.NewClass(42);
				oNewSubClassInstance = new sap.test.NewSubClass();
			}
		});

		QUnit.test("InitialObject", function(assert) {
			// assert("fresh object doesn't have interface", typeof oObject.oInterface === "undefined");
			assert.ok(oObject.getInterface === sap.ui.base.Object.prototype.getInterface, "fresh object doesn't have own getInterface implementation");
		});

		QUnit.test("GetInterface", function(assert) {
			var oIntf1 = oNewClassInstance.getInterface();
			assert.ok(oIntf1 !== undefined && oIntf1 !== null, "interface returned");
			// assert("object has interface member", oObject.oInterface && typeof oObject.oInterface === "object" );
			assert.ok(oNewClassInstance.getInterface !== sap.ui.base.Object.prototype.getInterface, "object has own getInterface implementation");
			var oIntf2 = oNewClassInstance.getInterface();
			assert.ok(oIntf1 === oIntf2, "stable interface");
			for(var m in oIntf1) {
				if ( typeof oIntf1[m] === "function" ) {
					assert.ok(oNewClassInstance.getMetadata().getAllPublicMethods().indexOf(m) >= 0, "interface has only functions from the list");
					// TODO the following tests only work for methods that have stable results and that don't require arguments
					var r1 = oNewClassInstance[m]();
					var r2 = oIntf1[m]();
					assert.strictEqual(r2, r1, "same values returned");
				}
			}
		});

		QUnit.test("GetMetadata", function(assert) {
			assert.ok(oNewClassInstance.getMetadata() != false, "metadata available");
			assert.ok(oNewSubClassInstance.getMetadata() != false, "metadata available");
		});

		QUnit.test("BaseTypeSet", function(assert) {
			assert.ok(oNewClassInstance.getMetadata().getParent() != false, "basetype set");
			assert.strictEqual("sap.ui.base.Object", oNewClassInstance.getMetadata().getParent().getName(), "basetype as expected");
			assert.ok(oNewSubClassInstance.getMetadata().getParent() != false, "basetype set");
			assert.strictEqual(oNewClassInstance.getMetadata(), oNewSubClassInstance.getMetadata().getParent(), "basetype as expected");
		});

		QUnit.test("PublicMethods", function(assert) {
			assertArrayEquals("public methods", oNewClassInstance.getMetadata().getPublicMethods(), ["method1"]);
			assertArrayEquals("public methods", oNewClassInstance.getMetadata().getAllPublicMethods(), ["method1"]);
			assertArrayEquals("public methods", oNewSubClassInstance.getMetadata().getPublicMethods(), ["method2"]);
			assertArrayEquals("public methods", oNewSubClassInstance.getMetadata().getAllPublicMethods(), ["method1", "method2"]);
		});

		QUnit.test("Interfaces", function(assert) {
			assertArrayEquals("interfaces", oNewClassInstance.getMetadata().getInterfaces(), ["sap.ui.base.Poolable"]);
			assert.ok(oNewClassInstance.getMetadata().isInstanceOf("sap.ui.base.Poolable"), "isInstanceOf");
			assert.ok(!oNewClassInstance.getMetadata().isInstanceOf("sap.ui.base.PureImagination"), "isInstanceOf");
			assertArrayEquals("interfaces", oNewSubClassInstance.getMetadata().getInterfaces(), ["sap.ui.base.Cacheable"]);
			assert.ok(oNewSubClassInstance.getMetadata().isInstanceOf("sap.ui.base.Cacheable"), "isInstanceOf");
			assert.ok(oNewSubClassInstance.getMetadata().isInstanceOf("sap.ui.base.Poolable"), "isInstanceOf");
		});

  	</script>
 	</head>
	<body>
		<h1 id="qunit-header">QUnit page for jquery.sap.properties</h1>
		<h2 id="qunit-banner"></h2>
	 	<h2 id="qunit-userAgent"></h2>
		<div id="qunit-testrunner-toolbar"></div>
		<ol id="qunit-tests"></ol>
	</body>
</html>
